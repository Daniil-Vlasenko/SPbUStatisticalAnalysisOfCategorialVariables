"0","mean.col <- function(df) {"
"0","  new.df <- df"
"0","  for (i in 1:ncol(df)) {"
"0","    new.df[, i] <- new.df[, i] - mean(df[, i])"
"0","  }"
"0","  return(new.df)"
"0","}"
"0",""
"0","loss.function <- function(X, G, Y) {"
"0","  m <- length(Y)"
"0","  value <- 0"
"0","  for (i in 1:m) {"
"0","    value <- value + sum(diag(t(X - G[[i]] %*% Y[[i]]) %*% (X - G[[i]] %*% Y[[i]])))"
"0","  }"
"0","  return(value)"
"0","}"
"0",""
"0","incidence_matrices <- function(df) {"
"0","  G <- list()"
"0","  for(i in 1:ncol(df)) {"
"0","    G[[i]] <- as.matrix(incidence_matrix(df[,i]))"
"0","  }"
"0","  return(G)"
"0","}"
"0",""
"0","multidim.scaling <- function(df, m) {"
"0","  n <- nrow(df)"
"0","  G <- incidence_matrices(df)"
"0","  "
"0","  X <- matrix(runif(n=n*m, min=0, max=1), nrow=n)"
"0","  X <- mean.col(X)"
"0","  X <- gramSchmidt(X)$Q"
"0","  Y <- list()"
"0","  for(i in 1:m) {"
"0","    Y[[i]] <- inv(t(G[[i]]) %*% G[[i]]) %*% t(G[[i]]) %*% X"
"0","  }"
"0","  "
"0","  loss.1 <- loss.function(X, G, Y)"
"0","  repeat {"
"0","    X <- X * 0"
"0","    for(i in 1:m) {"
"0","      X <- X + G[[i]] %*% Y[[i]]"
"0","    }"
"0","    X <- mean.col(X)"
"0","    X <- gramSchmidt(X)$Q"
"0","    Y <- list()"
"0","    for(i in 1:m) {"
"0","      Y[[i]] <- inv(t(G[[i]]) %*% G[[i]]) %*% t(G[[i]]) %*% X"
"0","    }"
"0","    "
"0","    if(abs(loss.function(X, G, Y) - loss.1) < 0.000001) {"
"0","      break"
"0","    }"
"0","    loss.1 = loss.function(X, G, Y)"
"0","  }"
"0","  return(X)"
"0","}"
"0",""
"0","ms <- as.data.frame(multidim.scaling(df.new, 4))"
"0","ms$index <- 1:nrow(ms)"
"0","ms$prcod <- as.factor(df$prcod)"
